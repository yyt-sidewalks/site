<!DOCTYPE html>
	<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta property="og:url" content="https://yyt-sidewalks.github.io/site/" />
		<meta property="og:type" content="website" />
		<meta property="og:title" content="Sidewalks in St John's, NL" />
		<meta property="og:description" content="A site for tracking sidewalk and pedestrian safety and usage in St. John's, NL" />
		<title>YYT Sidewalks - Open Data</title>
		<link rel="stylesheet" href="../css/main.css">
		<script src="../lib/load.js"></script>
		<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
<!--leaflet-->
<script src="https://unpkg.com/leaflet@1.5.0/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.0/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet-responsive-popup@0.6.4/leaflet.responsive.popup.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet-responsive-popup@0.6.4/leaflet.responsive.popup.css" />
<!--Location Plugin-->
<script src='https://cdn.jsdelivr.net/leaflet.locatecontrol/0.49.0/L.Control.Locate.min.js'></script>
<link href='https://cdn.jsdelivr.net/leaflet.locatecontrol/0.49.0/L.Control.Locate.css' rel='stylesheet' />
<!--Tabletop and GeoJson-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js"></script>
<script src="../lib/geojson.js"></script>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
	<body>
		<nav class="navbar">
			<div class="container is-fluid">
				<div class="navbar-brand">
					<a class="navbar-item" href="https://yyt-sidewalks.github.io/site">
						<img src="../images/icons/pedestrian.png" alt="Sidewalks in St. John's, NL" height="28">
					</a>
					<div class="navbar-burger burger" data-target="navbar">
						<span></span>
						<span></span>
						<span></span>
					</div>
				</div>
				<div id="navbar" class="navbar-menu">
					<div class="navbar-start">
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site">Home</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/about/">About</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/stories/">Stories</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/obstructions/">Obstructions</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/city-priorities/">City Clearing Priorities</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/reports-media/">Reports & Media</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/open-data/">Open Data</a>
						<a class="navbar-item" href="https://yyt-sidewalks.github.io/site/resources/">Resources</a>
					</div>
				</div>
			</div>
		</nav>
		<section id="main" class="section">
			<div class="container is-fluid">
				<div class="content">
					<div class="title is-size-2 is-size-4-touch">Open Data</div>
					<div class="subtitle is-size-6-touch">Open Data on the City of St. John's</div>
					<div id="controls">
						<h4 class="is-size-4">2016 Census Data</h4>
						<div class="field is-grouped is-grouped-multiline">
							<div class="control">
								<div class="select">
									<select id="censusdata">
										<option value="">Select Variable</option>
										<option value="percentages.walked.all">% Commuters who walk: all</option>
										<option value="percentages.walked.male">% Commuters who walk: men</option>
										<option value="percentages.walked.female">% Commuters who walk: women</option>
										<option value="percentages.transit.all">% Commuters who take transit: all</option>
										<option value="percentages.transit.male">% Commuters who take transit: men</option>
										<option value="percentages.transit.female">% Commuters who take transit: women</option>
										<option value="income.all">After-Tax Income: all</option>
										<option value="income.male">After-Tax Income: men</option>
										<option value="income.female">After-Tax Income: women</option>
										<option value="multi.income.walked.all">Low After-tax Income % Walking Commuters: all</option>
										<option value="multi.income.walked.male">Low After-tax Income % Walking Commuters: men</option>
										<option value="multi.income.walked.female">Low After-tax Income % Walking Commuters: women</option>
										<option value="population.density">Population Density</option>
									</select>
								</div>
							</div>
							<div class="control">
								<button id="resetareas" class="button is-primary">Reset</button>
							</div>
						</div>
						<div class="field">
							<button class="button is-info" id="zoommap">Zoom</button>
							<span id="zoomcontrols">
								<span class="gradientctl"><span class="spanlabel">More</span><span class="gradient"></span><span class="spanlabel">Less</span></span>
							</span>
							<button class="button is-info" id="shrinkmap"><i class="fas fa-times"></i></button>
							<a href="files/" class="button is-success">Review Data Files</a>
						</div>
					</div>
				</div>
				<div class="content">
					<div class="map">
						<div id="map"></div>
					</div>
				</div>
				<div class="content">
					<div id="blurb">
						<h4 class="is-size-4">Statistics</h4>
						<div class="columns">
							<div class="column is-4-desktop is-12-touch">
								<h5>Metro Avalon</h5>
								<ul id="metrostats">
							
								</ul>
							</div>
							<div class="column is-4-desktop is-12-touch">
								<h5>City of St. John's</h5>
								<ul id="citystats">
							
								</ul>
							</div>
							<div class="column is-4-desktop is-12-touch">
								<h5>Others</h5>
								<ul id="regionstats">
							
								</ul>
							</div>
						</div>
						
						<h3 class="is-size-3">About this page</h3>
						<p>The data on this page is drawn from the 2016 Canadian Census, as available from <a href="http://www.censusmapper.ca" target="_blank">www.censusmapper.ca</a>. It's been processed slightly to obtain a few variables, based on income and population density.</p>
						<h4 class="is-size-4">How to use this page</h4>
						<p>Select a variable to view the statistics for:</p>
						<ul>
							<li>Percentage of Commuters who walk to work</li>
							<li>Percentage of Commuters who take public transit to work</li>
							<li>After-tax income divided into ten quantiles (decile) or ranges from high to low</li>
							<li>Population density per square kilometer divided into ten quantiles (decile) or ranges from high to low</li>
						</ul>
					</div>
				</div>
			</div>
		</section>
	<footer class="footer has-text-centered">
		<div class="container is-fluid">
			<div class="columns">
				<div class="column is-8-desktop is-offset-2-desktop">
					<p>
						<small>
						Source code licensed <a href="http://opensource.org/licenses/mit-license.php">MIT</a>
						</small>
					</p>
					<p style="margin-top: 1rem;">
						<a href="http://bulma.io">
						<img src="../made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
						</a>
					</p>
				</div>
			</div>
		</div>
	</footer>
	<script type="text/javascript" src="../lib/main.js"></script>
	<script>
		var censusdata={data:{}},citydata={data:{}},regiondata={data:{}};
		var censusareas={};
		var layertoggles={},centretoggle=false;
		var alllayers={};
		var map = L.map('map',{zoomControl: false}).setView([47.5670, -52.7292], 14); //Initialize the map
		new L.Control.Zoom({ position: 'bottomleft' }).addTo(map);
		//Add a basemap
		var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		}).addTo(map);
		var citylayer = new L.geoJson(null,{
			style: function(geoJsonFeature){
				return {fillColor: 'transparent', color:'#0D3764', weight: '8', fillOpacity: 1}
			}
		});
		citylayer.addTo(map);
		alllayers['city']=citylayer;
		layertoggles['city']=true;
		$.ajax({
			dataType: "json",
			url: "cityboundary.json",
			success: function(data) {
				citylayer.addData(data);
			}
		});
		var wardcensus='',citycensusareas=[];
		$.ajax({
			dataType: "json",
			url: "wardcensus.json",
			success: function(data) {
				wardcensus=data;
				$.each(wardcensus,function(k,v){
					$.each(v,function(wk,wv){
						citycensusareas.push(wk);
					});
				});
				$.ajax({
					dataType: "json",
					url: "demographics.json",
					success: function(data) {
						builddata(data);
					}
				});
			}
		});
		var censuslayer;
		function censuslayer(){
			censuslayer = new L.geoJson(null,{
				style: function(geoJsonFeature){
					return {fillColor: 'transparent', color:'none', weight: '0', fillOpacity: 0.2}
				},
				onEachFeature: function(feature, layer){
					censusareas[feature.properties.id] = layer;
					var popupcontent='<h5>2016 Census Area '+feature.properties.id+'</h5><p>Area (sq km): '+compiled.metro.data[feature.properties.id]['Area (sq km)']+'<br>Population: '+compiled.metro.data[feature.properties.id].Population+'<br>Dwellings: '+compiled.metro.data[feature.properties.id].Dwellings+'<br>Households: '+compiled.metro.data[feature.properties.id].Households+'<br>Density (sq km): '+compiled.metro.data[feature.properties.id].density+'<br>Average after-tax income in 2015 - Female: $'+compiled.metro.data[feature.properties.id].Data.v_CA16_4965.value+'<br>Average after-tax income in 2015 - Male: $'+compiled.metro.data[feature.properties.id].Data.v_CA16_4964.value+'<br>Average after-tax income in 2015: $'+	compiled.metro.data[feature.properties.id].Data.v_CA16_4963.value+'</p><h6>Commuting</h6><ul><li>Walked - Female: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5806.value+'</li><li>Walked - Male: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5805.value+'</li><li>Walked: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5804.value+'</li><li>Public transit - Female: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5803.value+'</li><li>Public transit - Male: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5802.value+'</li><li>Public transit: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5801.value+'</li><li>Total - 25% sample data - Female: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5794.value+'</li><li>Total - 25% sample data - Male: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5793.value+'</li><li>Total - 25% sample data: '+compiled.metro.data[feature.properties.id].Data.v_CA16_5792.value+'</li></ul>';
					if(!isMobile){
						layer.bindPopup(popupcontent,{maxWidth : 600,minWidth:400,className:'datapopup'});
					}else{
						layer.bindPopup(popupcontent,{className:'datapopup'});
					}
					$('a.leaflet-popup-close-button').html('<i class="fas fa-times"></i>');
				}
			});
			censuslayer.addTo(map);
			alllayers['census']=censuslayer;
			layertoggles['census']=false;
			$.ajax({
				dataType: "json",
				url: "censuszones.json",
				success: function(data) {
					$(data.features).each(function(key, data) {
						censuslayer.addData(data);
					});
				}
			});
		}
		zoombg=true;
		$(function() {
			$('#censusdata').change(function(){
				updateareas($(this).val());
			});
			$('#resetareas').click(function(){
				$('#censusdata').val('');
				resetareas();
			});
			$('.datatoggle').click(function(){
				togglelayers($(this).data('layer'));
			});
			togglelayers('centres');
			setTimeout(function() {
				updateareas('percentages.walked.all');
				$('#censusdata').val('percentages.walked.all');
			}, 1500);
		});
		var subs=['all','male','female'];
		var dataareas=['metro','city','region'];
		var compiled={};
		$.each(dataareas,function(k,v){
			compiled[v]={};
			compiled[v].data={};
			compiled[v].averages={afterTaxIncome:{all:0,female:0,male:0},percentagesWalked:{all:0,female:0,male:0},percentagesTransit:{all:0,female:0,male:0}};
			compiled[v].totals={afterTaxIncome:{all:0,female:0,male:0},percentagesWalked:{all:0,female:0,male:0},percentagesTransit:{all:0,female:0,male:0},population:0};
			compiled[v].values={afterTaxIncome:{all:[],female:[],male:[]},percentagesWalked:{all:[],female:[],male:[]},percentagesTransit:{all:[],female:[],male:[]},density:[]};
			compiled[v].max={percentagesWalked:{all:0,female:0,male:0},percentagesTransit:{all:0,female:0,male:0},density:0,afterTaxIncome:{all:0,female:0,male:0}};
			compiled[v].min={percentagesWalked:{all:0,female:0,male:0},percentagesTransit:{all:0,female:0,male:0},density:0,afterTaxIncome:{all:0,female:0,male:0}};
			compiled[v].ranges={afterTaxIncome:[0],density:[0]};
			compiled[v].tiers={afterTaxIncome:{all:0,female:0,male:0},density:0};
			compiled[v].wards={ward_1:{},ward_2:{},ward_3:{},ward_4:{},ward_5:{}};
			compiled[v].hasAfterTaxIncome={all:0,female:0,male:0};
			compiled[v].hasWalked={all:0,female:0,male:0};
			compiled[v].hasTransit={all:0,female:0,male:0};
		});
		function builddata(info){
			$.each(info,function(k,v){
				var docompilations=['metro'];
				//census area is inside city
				if(citycensusareas.includes(String(v.GeoUID))){
					docompilations.push('city');
				}else{
					docompilations.push('region');
				}
				$.each(docompilations,function(ck,cv){
					compiled[cv].data[v.GeoUID]=v;
					compiled[cv].data[v.GeoUID].density=Math.ceil(parseInt(v.Population)*(1/parseFloat(v['Area (sq km)'])));
					compiled[cv].values.density.push(compiled[cv].data[v.GeoUID].density);
					compiled[cv].data[v.GeoUID].percentages={};
					compiled[cv].data[v.GeoUID].percentages.walked={};
					if(parseInt(v.Data.v_CA16_5792.value)){
						compiled[cv].data[v.GeoUID].percentages.walked.all=parseInt(v.Data.v_CA16_5804.value)/parseInt(v.Data.v_CA16_5792.value);
						compiled[cv].values.percentagesWalked.all.push(compiled[cv].data[v.GeoUID].percentages.walked.all);
						compiled[cv].hasWalked.all++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.walked.all=0;
						compiled[cv].values.percentagesWalked.all.push(0);
					}
					if(parseInt(v.Data.v_CA16_5794.value)){
						compiled[cv].data[v.GeoUID].percentages.walked.female=parseInt(v.Data.v_CA16_5806.value)/parseInt(v.Data.v_CA16_5794.value);
						compiled[cv].values.percentagesWalked.female.push(compiled[cv].data[v.GeoUID].percentages.walked.female);
						compiled[cv].hasWalked.female++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.walked.female=0;
						compiled[cv].values.percentagesWalked.female.push(0);
					}
					if(parseInt(v.Data.v_CA16_5793.value)){
						compiled[cv].data[v.GeoUID].percentages.walked.male=parseInt(v.Data.v_CA16_5805.value)/parseInt(v.Data.v_CA16_5793.value);
						compiled[cv].values.percentagesWalked.male.push(compiled[cv].data[v.GeoUID].percentages.walked.male);
						compiled[cv].hasWalked.male++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.walked.male=0;
						compiled[cv].values.percentagesWalked.male.push(0);
					}
					compiled[cv].data[v.GeoUID].percentages.transit={};
					if(parseInt(v.Data.v_CA16_5792.value)){
						compiled[cv].data[v.GeoUID].percentages.transit.all=parseInt(v.Data.v_CA16_5801.value)/parseInt(v.Data.v_CA16_5792.value);
						compiled[cv].values.percentagesTransit.all.push(compiled[cv].data[v.GeoUID].percentages.transit.all);
						compiled[cv].hasTransit.all++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.transit.all=0;
						compiled[cv].values.percentagesTransit.all.push(0);
					}
					if(parseInt(v.Data.v_CA16_5794.value)){
						compiled[cv].data[v.GeoUID].percentages.transit.female=parseInt(v.Data.v_CA16_5803.value)/parseInt(v.Data.v_CA16_5794.value);
						compiled[cv].values.percentagesTransit.female.push(compiled[cv].data[v.GeoUID].percentages.transit.female);
						compiled[cv].hasTransit.female++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.transit.female=0;
						compiled[cv].values.percentagesTransit.female.push(0);
					}
					if(parseInt(v.Data.v_CA16_5793.value)){
						compiled[cv].data[v.GeoUID].percentages.transit.male=parseInt(v.Data.v_CA16_5802.value)/parseInt(v.Data.v_CA16_5793.value);
						compiled[cv].values.percentagesTransit.male.push(compiled[cv].data[v.GeoUID].percentages.transit.male);
						compiled[cv].hasTransit.male++;
					}else{
						compiled[cv].data[v.GeoUID].percentages.transit.male=0;
						compiled[cv].values.percentagesTransit.male.push(0);
					}
					if(parseInt(v.Data.v_CA16_4963.value)){
						compiled[cv].totals.afterTaxIncome.all=compiled[cv].totals.afterTaxIncome.all+parseInt(v.Data.v_CA16_4963.value);
						compiled[cv].hasAfterTaxIncome.all++;
						compiled[cv].values.afterTaxIncome.all.push(parseInt(v.Data.v_CA16_4964.value));
					}
					if(parseInt(v.Data.v_CA16_4964.value)){
						compiled[cv].totals.afterTaxIncome.male=compiled[cv].totals.afterTaxIncome.male+parseInt(v.Data.v_CA16_4964.value);
						compiled[cv].hasAfterTaxIncome.male++;
						compiled[cv].values.afterTaxIncome.male.push(parseInt(v.Data.v_CA16_4964.value));
					}
					if(parseInt(v.Data.v_CA16_4965.value)){
						compiled[cv].totals.afterTaxIncome.female=compiled[cv].totals.afterTaxIncome.female+parseInt(v.Data.v_CA16_4965.value);
						compiled[cv].hasAfterTaxIncome.female++;
						compiled[cv].values.afterTaxIncome.female.push(parseInt(v.Data.v_CA16_4965.value));
					}
					if(parseInt(v.Population)){
						compiled[cv].totals.population=compiled[cv].totals.population+parseInt(v.Population);
					}
				});
			});
			$.each(dataareas,function(ck,cv){
				$.each(subs,function(k,v){
					compiled[cv].averages.afterTaxIncome[v]=Math.ceil(compiled[cv].totals.afterTaxIncome[v]/compiled[cv].hasAfterTaxIncome[v]);
					compiled[cv].averages.percentagesWalked[v]=Math.ceil(compiled[cv].totals.percentagesWalked[v]/compiled[cv].hasWalked[v]);
					compiled[cv].averages.percentagesTransit[v]=Math.ceil(compiled[cv].totals.percentagesTransit[v]/compiled[cv].hasTransit[v]);
					compiled[cv].max.afterTaxIncome[v]=Math.max.apply(Math,compiled[cv].values.afterTaxIncome[v]);
					compiled[cv].min.afterTaxIncome[v]=Math.min.apply(Math,compiled[cv].values.afterTaxIncome[v]);
					compiled[cv].max.percentagesWalked[v]=Math.max.apply(Math,compiled[cv].values.percentagesWalked[v])*100;
					compiled[cv].max.percentagesTransit[v]=Math.max.apply(Math,compiled[cv].values.percentagesTransit[v])*100;
					compiled[cv].min.percentagesWalked[v]=Math.min.apply(Math,compiled[cv].values.percentagesWalked[v])*100;
					compiled[cv].min.percentagesTransit[v]=Math.min.apply(Math,compiled[cv].values.percentagesTransit[v])*100;
					compiled[cv].tiers.afterTaxIncome[v]=Math.ceil(compiled[cv].max.afterTaxIncome[v]/(gradient.length-1));
				});
				compiled[cv].max.density=Math.max.apply(Math,compiled[cv].values.density);
				compiled[cv].min.density=Math.min.apply(Math,compiled[cv].values.density);
				compiled[cv].tiers.density=Math.ceil(compiled[cv].max.density/(gradient.length-1));

				//calculate tiers for gradients
				$.each(gradient,function(k,v){
					if(k){
						var lastkey=k-1;
						compiled[cv].ranges.afterTaxIncome.push(compiled[cv].tiers.afterTaxIncome+compiled[cv].ranges.afterTaxIncome[lastkey]);
						compiled[cv].ranges.density.push(compiled[cv].tiers.density+compiled[cv].ranges.density[lastkey]);
					}
				});
			});
			censuslayer();
			warddata();
		}
		
		function warddata(){
			$.each(wardcensus,function(k,v){
				compiled['city'].wards[k].walked={all:0,female:0,male:0};
				compiled['city'].wards[k].transit={all:0,female:0,male:0};
				compiled['city'].wards[k].commuters={all:0,female:0,male:0};
				compiled['city'].wards[k].population=0;
				//each ward
				$.each(v,function(ok,ov){
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5804.value)){
						compiled['city'].wards[k].walked.all=compiled['city'].wards[k].walked.all+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5804.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5806.value)){
						compiled['city'].wards[k].walked.female=compiled['city'].wards[k].walked.female+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5806.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5805.value)){
						compiled['city'].wards[k].walked.male=compiled['city'].wards[k].walked.male+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5805.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5801.value)){
						compiled['city'].wards[k].transit.all=compiled['city'].wards[k].transit.all+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5801.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5803.value)){
						compiled['city'].wards[k].transit.female=compiled['city'].wards[k].transit.female+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5803.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5802.value)){
						compiled['city'].wards[k].transit.male=compiled['city'].wards[k].transit.male+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5802.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5792.value)){
						compiled['city'].wards[k].commuters.all=compiled['city'].wards[k].commuters.all+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5792.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5794.value)){
						compiled['city'].wards[k].commuters.female=compiled['city'].wards[k].commuters.female+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5794.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_5793.value)){
						compiled['city'].wards[k].commuters.male=compiled['city'].wards[k].commuters.male+Math.round(parseInt(compiled['city'].data[ok].Data.v_CA16_5793.value)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Population)){
						compiled['city'].wards[k].population=compiled['city'].wards[k].population+Math.round(parseInt(compiled['city'].data[ok].Population)*ov.percentageareaward);
					}
					if(parseInt(compiled['city'].data[ok].Data.v_CA16_4963.value)){
						compiled['city'].totals.afterTaxIncome.all=compiled['city'].totals.afterTaxIncome.all+parseInt(compiled['city'].data[ok].Data.v_CA16_4963.value);
						compiled['city'].values.afterTaxIncome.all.push(parseInt(compiled['city'].data[ok].Data.v_CA16_4963.value));
					}
				});
			});
		}
		function updateareas(e){
			resetareas();
			var step=1,opacity=0.3,incomerange=0;
			switch(e){
				case "multi.income.walked.all":
					step=100/(gradient.length-1);
					incomerange=compiled['metro'].max.afterTaxIncome.all;
					$.each(compiled['metro'].data,function(k,v){
						var var1=v.percentages.walked.all*200;
						var var2=100-((parseInt(v.Data.v_CA16_4963.value)/incomerange)*100);
						var multi=(var1+var2)/2;
						var rounded=Math.ceil(Math.round(multi/step));
						if(rounded<0){
							rounded=0;
						}
						if(rounded>10){
							rounded=gradient.length-1;
						}
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$.each(subs,function(ck,cv){
							$('#'+v+'stats').append('<li><strong>Percentage of '+cv+' Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked[cv].toPrecision(3)+'</li>');
						});
						$('#'+v+'stats').append('<li><strong>Overall After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.all+'</li>');
						$('#'+v+'stats').append('<li><strong>Max After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.all+'</li>');
						$('#'+v+'stats').append('<li><strong>Min After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.all+'</li>');
					});
				break;
				case "multi.income.walked.female":
					step=100/(gradient.length-1);
					incomerange=compiled['metro'].max.afterTaxIncome.female;
					$.each(compiled['metro'].data,function(k,v){
						var var1=v.percentages.walked.female*200;
						var var2=100-((parseInt(v.Data.v_CA16_4965.value)/incomerange)*100);
						var multi=(var1+var2)/2;
						var rounded=Math.ceil(Math.round(multi/step));
						if(rounded<0){
							rounded=0;
						}
						if(rounded>10){
							rounded=gradient.length-1;
						}
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Female Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked.female.toPrecision(3)+'</li>');
						$('#'+v+'stats').append('<li><strong>Overall Female After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.female+'</li>');
						$('#'+v+'stats').append('<li><strong>Max Female After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.female+'</li>');
						$('#'+v+'stats').append('<li><strong>Min Female After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.female+'</li>');
					});
				break;
				case "multi.income.walked.male":
					step=100/(gradient.length-1);
					incomerange=compiled['metro'].max.afterTaxIncome.male;
					$.each(compiled['metro'].data,function(k,v){
						var var1=v.percentages.walked.male*200;
						var var2=100-((parseInt(v.Data.v_CA16_4964.value)/incomerange)*100);
						var multi=(var1+var2)/2;
						var rounded=Math.ceil(Math.round(multi/step));
						if(rounded<0){
							rounded=0;
						}
						if(rounded>10){
							rounded=gradient.length-1;
						}
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Male Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked.male.toPrecision(3)+'</li>');
						$('#'+v+'stats').append('<li><strong>Overall Male After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.male+'</li>');
						$('#'+v+'stats').append('<li><strong>Max Male After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.male+'</li>');
						$('#'+v+'stats').append('<li><strong>Min Male After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.male+'</li>');
					});
				break;
				case "percentages.walked.all":
					step=compiled['metro'].max.percentagesWalked.all/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.walked.all*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$.each(subs,function(ck,cv){
							$('#'+v+'stats').append('<li><strong>Percentage of '+cv+' Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked[cv].toPrecision(3)+'</li>');
						});
					});
				break;
				case "percentages.walked.female":
					step=compiled['metro'].max.percentagesWalked.female/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.walked.female*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Female Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked.female.toPrecision(3)+'</li>');
					});
				break;
				case "percentages.walked.male":
					step=compiled['metro'].max.percentagesWalked.male/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.walked.male*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Male Commuters who Walk: </strong> '+compiled[v].max.percentagesWalked.male.toPrecision(3)+'</li>');
					});
				break;
				case "percentages.transit.all":
					step=compiled['metro'].max.percentagesWalked.all/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.transit.all*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$.each(subs,function(ck,cv){
							$('#'+v+'stats').append('<li><strong>Percentage of Commuters who use Public Transit: </strong> '+compiled[v].max.percentagesTransit[cv].toPrecision(3)+'</li>');
						});
					});
				break;
				case "percentages.transit.male":
					step=compiled['metro'].max.percentagesWalked.male/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.transit.male*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Male Commuters who use Public Transit: </strong> '+compiled[v].max.percentagesTransit.male.toPrecision(3)+'</li>');
					});
				break;
				case "percentages.transit.female":
					step=compiled['metro'].max.percentagesWalked.female/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round((v.percentages.transit.female*100)/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Percentage of Male Commuters who use Public Transit: </strong> '+compiled[v].max.percentagesTransit.female.toPrecision(3)+'</li>');
					});
				break;
				case "income.female":
					step=compiled['metro'].max.afterTaxIncome.all/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round(v.Data.v_CA16_4965.value/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Overall Female After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.female+'</li>');
						$('#'+v+'stats').append('<li><strong>Max Female After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.female+'</li>');
						$('#'+v+'stats').append('<li><strong>Min Female After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.female+'</li>');
						$('#'+v+'stats').append('<li><strong>Step: </strong> $'+step+'</li>');
					});
				break;
				case "income.male":
					step=compiled['metro'].max.afterTaxIncome.all/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round(v.Data.v_CA16_4964.value/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Overall Male After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.male+'</li>');
						$('#'+v+'stats').append('<li><strong>Max Male After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.male+'</li>');
						$('#'+v+'stats').append('<li><strong>Min Male After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.male+'</li>');
						$('#'+v+'stats').append('<li><strong>Step: </strong> $'+step+'</li>');
					});
				break;
				case "income.all":
					step=compiled['metro'].max.afterTaxIncome.all/(gradient.length-1);
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round(v.Data.v_CA16_4963.value/step));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Overall After-Tax Income Average: </strong> $'+compiled[v].averages.afterTaxIncome.all+'</li>');
						$('#'+v+'stats').append('<li><strong>Max After-Tax Income: </strong> $'+compiled[v].max.afterTaxIncome.all+'</li>');
						$('#'+v+'stats').append('<li><strong>Min After-Tax Income: </strong> $'+compiled[v].min.afterTaxIncome.all+'</li>');
						$('#'+v+'stats').append('<li><strong>Step: </strong> $'+step+'</li>');
					});
				break;
				case "population.density":
					step=compiled['metro'].tiers.density;
					$.each(compiled['metro'].data,function(k,v){
						var rounded=Math.ceil(Math.round(v.density/compiled['metro'].tiers.density));
						opacity=0.4;
						if(citycensusareas.includes(String(v.GeoUID))){
							opacity=0.7;
						}
						censusareas[v.GeoUID].setStyle({fillColor:gradient[rounded],fillOpacity: opacity});
					});
					$.each(dataareas,function(k,v){
						$('#'+v+'stats').append('<li><strong>Population per sq km: </strong> '+compiled[v].totals.population+'</li>');
					});
				break;
			}
		}
		function resetareas(){
			$('#citystats,#metrostats,#regionstats').empty();
			$.each(censusareas,function(k,v){
				censusareas[k].setStyle({fillColor: 'transparent', color:'#282828', weight: '1', fillOpacity: 0.2});
			});
		}
		function togglelayers(l) {
			if(l=="centres"){
				if(!centretoggle){
					$.each(layertoggles,function(k,v){
						if(!v && (k=='schools' || k=='hospitals')){
							map.removeLayer(alllayers[k]);
							layertoggles[k] = !layertoggles[k];
							$('#'+k+'ctl').text('show');
						}
					});
					$('#centresctl').text('show');
				} else {
					$.each(layertoggles,function(k,v){
						if(v && (k=='schools' || k=='hospitals')){
							map.addLayer(alllayers[k]);
							layertoggles[k] = !layertoggles[k];
							$('#'+k+'ctl').text('hide');
						}
					});
					$('#centresctl').text('hide');
				}
				centretoggle = !centretoggle;
			}else{
				if(!layertoggles[l]){
					map.removeLayer(alllayers[l]);
					$('#'+l+'ctl').text('show');
				} else {
					map.addLayer(alllayers[l]);
					$('#'+l+'ctl').text('hide');
				}
				layertoggles[l] = !layertoggles[l];
			}
		}
	</script>
	<link rel="stylesheet" href="../css/leaflet.css">
	</body>
</html>
